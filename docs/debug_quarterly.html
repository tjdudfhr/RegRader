<!DOCTYPE html>
<html>
<head>
    <title>Debug Quarterly Functionality</title>
    <style>
        .quarterly-detail-section {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-top: 1rem;
            overflow: hidden;
            transition: all 0.5s ease;
            max-height: 0;
            opacity: 0;
            display: none;
        }
        .quarterly-detail-section.expanded {
            max-height: 2000px;
            opacity: 1;
            display: block !important;
        }
        .quarterly-detail-content {
            padding: 2rem;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>분기탭 기능 디버깅</h1>
    
    <button onclick="testShowQuarterlyDetail('Q1')">Q1 분기 테스트</button>
    <button onclick="testShowQuarterlyDetail('Q2')">Q2 분기 테스트</button>
    
    <!-- 분기별 상세 섹션 -->
    <div class="quarterly-detail-section" id="quarterly-detail">
        <div class="quarterly-detail-content">
            <!-- 동적 내용이 여기에 들어갑니다 -->
        </div>
    </div>
    
    <div id="debug-log"></div>
    
    <script>
        let currentQuarterlyDetail = null;
        
        function log(message) {
            console.log(message);
            const debugLog = document.getElementById('debug-log');
            debugLog.innerHTML += '<p>' + message + '</p>';
        }
        
        function testShowQuarterlyDetail(quarter) {
            log('🎯 showQuarterlyDetail 함수 호출: ' + quarter);
            
            const quarterInfo = {
                'Q1': { title: '1분기 개정 법령', period: '2025년 1~3월', months: [1, 2, 3], icon: '🌱' },
                'Q2': { title: '2분기 개정 법령', period: '2025년 4~6월', months: [4, 5, 6], icon: '☀️' },
                'Q3': { title: '3분기 개정 법령', period: '2025년 7~9월', months: [7, 8, 9], icon: '🍂' },
                'Q4': { title: '4분기 개정 법령', period: '2025년 10~12월', months: [10, 11, 12], icon: '❄️' }
            };
            
            const info = quarterInfo[quarter];
            if (!info) {
                log('❌ 분기 정보를 찾을 수 없습니다: ' + quarter);
                return;
            }
            
            log('✅ 분기 정보 확인: ' + info.title);
            
            // 2025년 매칭된 법규 데이터를 동적으로 로드하여 분기별 필터링
            fetch('quarterly_details.json')
                .then(response => {
                    log('📡 quarterly_details.json 요청 시작...');
                    if (!response.ok) throw new Error('데이터 로드 실패: ' + response.status);
                    return response.json();
                })
                .then(quarterlyData => {
                    log('✅ quarterly_details.json 로드 성공');
                    const quarterLaws = quarterlyData.quarters[quarter].laws || [];
                    log('📋 ' + quarter + ' 분기 법령 수: ' + quarterLaws.length + '개');
                    
                    // continueShowQuarterlyDetail 호출
                    continueShowQuarterlyDetail(quarter, info, quarterLaws);
                })
                .catch(error => {
                    log('❌ quarterly_details.json 로드 실패: ' + error.message);
                    
                    // 폴백 데이터 생성
                    const fallbackLaws = [{
                        title: quarter + ' 테스트 법령',
                        effective_date: '2025-03-01',
                        categories: ['환경'],
                        ministry: '테스트부처',
                        law_type: '일부개정',
                        detail_url: 'https://www.law.go.kr'
                    }];
                    continueShowQuarterlyDetail(quarter, info, fallbackLaws);
                });
        }
        
        function continueShowQuarterlyDetail(quarter, info, quarterLaws) {
            log('🚀 continueShowQuarterlyDetail 호출: ' + quarter + ', 법령 수: ' + quarterLaws.length);
            showQuarterlyModal(quarter, info, quarterLaws);
        }
        
        function showQuarterlyModal(quarter, info, quarterLaws) {
            log('📱 showQuarterlyModal 호출 시작');
            
            // 간단한 내용 생성
            const detailContent = `
                <div style="padding: 20px;">
                    <h2>${info.icon} ${info.title}</h2>
                    <p><strong>기간:</strong> ${info.period}</p>
                    <p><strong>법령 수:</strong> ${quarterLaws.length}건</p>
                    <button onclick="closeQuarterlyDetail()">닫기</button>
                    
                    <h3>법령 목록:</h3>
                    <ul>
                        ${quarterLaws.slice(0, 5).map(law => `
                            <li><strong>${law.title}</strong> (${law.effective_date})</li>
                        `).join('')}
                    </ul>
                </div>
            `;
            
            // 내용 삽입 및 애니메이션 표시
            const detailSection = document.getElementById('quarterly-detail');
            const contentDiv = detailSection.querySelector('.quarterly-detail-content');
            contentDiv.innerHTML = detailContent;
            
            log('📄 내용 삽입 완료');
            
            // 슬라이드 다운 애니메이션
            detailSection.style.display = 'block';
            setTimeout(() => {
                detailSection.classList.add('expanded');
                log('✨ 슬라이드 애니메이션 시작');
            }, 10);
            
            currentQuarterlyDetail = quarter;
            
            // 부드러운 스크롤
            setTimeout(() => {
                detailSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                log('📍 스크롤 이동 완료');
            }, 300);
        }
        
        function closeQuarterlyDetail() {
            log('❌ closeQuarterlyDetail 호출');
            const detailSection = document.getElementById('quarterly-detail');
            detailSection.classList.remove('expanded');
            
            setTimeout(() => {
                detailSection.style.display = 'none';
                log('🔒 슬라이드 닫기 완료');
            }, 500);
            
            currentQuarterlyDetail = null;
        }
    </script>
</body>
</html>