<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAW WATCH Â· ì˜¬í•´ ê°œì • ë²•ë ¹</title>
    <style>
        :root {
            --brand: #2563eb;
            --text: #0b1220;
            --muted: #6b7280;
            --bg: #f5f7fb;
            --card: #ffffff;
            --bd: #e5e7eb;
            --ok: #16a34a;
            --warn: #d97706;
            --c-safety: #22c55e;
            --c-env: #10b981;
            --c-hr: #f59e0b;
            --c-gov: #6366f1;
            --c-fin: #0ea5e9;
            --c-sec: #ef4444;
            --c-etc: #9ca3af;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #e5e7eb;
                --muted: #9ca3af;
                --bg: #050a12;
                --card: #0d1117;
                --bd: #1f2937;
                --brand: #63a4ff;
            }
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: Inter, Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            color: var(--text);
            background: var(--bg);
        }

        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            padding: 22px;
        }

        header {
            display: flex;
            align-items: end;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        h1 {
            margin: 0;
            font-size: 26px;
            letter-spacing: 0.2px;
        }

        .meta {
            color: var(--muted);
            font-size: 13px;
        }

        .kpis {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 14px 0 18px;
        }

        .kpi {
            background: var(--card);
            border: 1px solid var(--bd);
            border-radius: 16px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .kpi .shape {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 800;
            font-size: 18px;
        }

        .kpi .txt .label {
            color: var(--muted);
            font-size: 12px;
        }

        .kpi .txt .value {
            font-weight: 800;
            font-size: 20px;
        }

        .btn {
            background: var(--brand);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
        }

        .panel {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 14px;
            margin-bottom: 16px;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--bd);
            border-radius: 16px;
            padding: 16px;
        }

        .law-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .law-item {
            border-bottom: 1px solid var(--bd);
            padding: 12px 0;
        }

        .law-item:last-child {
            border-bottom: none;
        }

        .law-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .law-meta {
            color: var(--muted);
            font-size: 12px;
        }

        .category-tag {
            display: inline-block;
            background: var(--bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 4px;
        }

        .loading {
            text-align: center;
            color: var(--muted);
            padding: 20px;
        }

        .error {
            text-align: center;
            color: var(--warn);
            padding: 20px;
        }

        @media (max-width: 768px) {
            .panel {
                grid-template-columns: 1fr;
            }
            .kpis {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div>
                <h1>LAW WATCH Â· <span id="year">2025</span> ê°œì • ë²•ë ¹</h1>
                <div class="meta">
                    ë°ì´í„°: <a href="./index.json" target="_blank">index.json</a> Â· 
                    <span id="timestamp">ë¡œë”© ì¤‘...</span>
                </div>
            </div>
            <a class="btn" href="https://github.com/tjdudfhr/law-watch" target="_blank">GitHub</a>
        </header>

        <div class="kpis">
            <div class="kpi">
                <div class="shape" style="background: var(--brand);">ğŸ“Š</div>
                <div class="txt">
                    <div class="label">ì˜¬í•´ ì „ì²´</div>
                    <div class="value" id="total-count">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            <div class="kpi">
                <div class="shape" style="background: var(--warn);">âš¡</div>
                <div class="txt">
                    <div class="label">D-7 ì˜ˆì •</div>
                    <div class="value" id="d7-count">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            <div class="kpi">
                <div class="shape" style="background: var(--ok);">ğŸ“…</div>
                <div class="txt">
                    <div class="label">D-30 ì˜ˆì •</div>
                    <div class="value" id="d30-count">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            <div class="kpi">
                <div class="shape" style="background: var(--c-safety);">âœ…</div>
                <div class="txt">
                    <div class="label">ì‹œí–‰ ì¤‘</div>
                    <div class="value" id="active-count">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="card">
                <h3>ì§ë¬´ ì¹´í…Œê³ ë¦¬ ë¶„í¬</h3>
                <div id="category-stats">ë¡œë”© ì¤‘...</div>
            </div>
            <div class="card">
                <h3>ìµœê·¼ ê°œì • ë²•ë ¹ <span id="recent-count">(ë¡œë”© ì¤‘...)</span></h3>
                <div class="law-list" id="law-list">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                console.log('ë°ì´í„° ë¡œë”© ì‹œì‘...');
                const response = await fetch('./index.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ë°ì´í„° ë¡œë”© ì„±ê³µ:', data);
                
                displayData(data);
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                document.getElementById('total-count').textContent = 'ì˜¤ë¥˜';
                document.getElementById('d7-count').textContent = 'ì˜¤ë¥˜';
                document.getElementById('d30-count').textContent = 'ì˜¤ë¥˜';
                document.getElementById('active-count').textContent = 'ì˜¤ë¥˜';
                document.getElementById('timestamp').textContent = 'ë¡œë”© ì‹¤íŒ¨';
                document.getElementById('law-list').innerHTML = '<div class="error">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message + '</div>';
                document.getElementById('category-stats').innerHTML = '<div class="error">ì˜¤ë¥˜</div>';
                document.getElementById('recent-count').textContent = '(ì˜¤ë¥˜)';
            }
        }

        function displayData(data) {
            const items = data.items || [];
            const generatedAt = data.generatedAt || 0;
            const year = data.year || 2025;
            
            console.log(`ì´ ${items.length}ê°œ í•­ëª© ì²˜ë¦¬ ì‹œì‘`);

            // ì—°ë„ì™€ íƒ€ì„ìŠ¤íƒ¬í”„ í‘œì‹œ
            document.getElementById('year').textContent = year;
            const date = new Date(generatedAt * 1000);
            document.getElementById('timestamp').textContent = date.toLocaleString('ko-KR');

            // ë‚ ì§œ ê³„ì‚°ì„ ìœ„í•œ í•¨ìˆ˜
            function getDaysFromNow(dateStr) {
                if (!dateStr) return null;
                const targetDate = new Date(dateStr);
                const now = new Date();
                const diffTime = targetDate - now;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }

            // í†µê³„ ê³„ì‚°
            let d7Count = 0;
            let d30Count = 0;
            let activeCount = 0;
            const categoryCounts = {};

            items.forEach(item => {
                const days = getDaysFromNow(item.effectiveDate);
                
                if (days !== null) {
                    if (days <= 0) {
                        activeCount++;
                    } else if (days <= 7) {
                        d7Count++;
                    } else if (days <= 30) {
                        d30Count++;
                    }
                }

                // ì¹´í…Œê³ ë¦¬ í†µê³„
                (item.categories || ['ê¸°íƒ€']).forEach(cat => {
                    categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
                });
            });

            // KPI í‘œì‹œ
            document.getElementById('total-count').textContent = items.length.toLocaleString();
            document.getElementById('d7-count').textContent = d7Count.toLocaleString();
            document.getElementById('d30-count').textContent = d30Count.toLocaleString();
            document.getElementById('active-count').textContent = activeCount.toLocaleString();

            // ì¹´í…Œê³ ë¦¬ í†µê³„ í‘œì‹œ
            const categoryStatsHtml = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8)
                .map(([category, count]) => 
                    `<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>${category}</span>
                        <strong>${count}</strong>
                    </div>`
                ).join('');

            document.getElementById('category-stats').innerHTML = categoryStatsHtml || '<div class="muted">ë°ì´í„° ì—†ìŒ</div>';

            // ë²•ë ¹ ëª©ë¡ í‘œì‹œ (ìµœê·¼ 50ê°œ)
            const sortedItems = items
                .sort((a, b) => {
                    const dateA = a.effectiveDate || '1900-01-01';
                    const dateB = b.effectiveDate || '1900-01-01';
                    return dateB.localeCompare(dateA);
                })
                .slice(0, 50);

            const lawListHtml = sortedItems
                .map(item => {
                    const categories = (item.categories || ['ê¸°íƒ€'])
                        .map(cat => `<span class="category-tag">${cat}</span>`)
                        .join('');
                    
                    const effectiveDate = item.effectiveDate || 'ë¯¸ì •';
                    const ministry = item.meta?.ministry || '';
                    
                    return `<div class="law-item">
                        <div class="law-title">${item.title || 'ì œëª© ì—†ìŒ'}</div>
                        <div class="law-meta">
                            ${categories}
                            <br>
                            ì‹œí–‰ì¼: ${effectiveDate} ${ministry ? `Â· ${ministry}` : ''}
                            ${item.lawType ? `Â· ${item.lawType}` : ''}
                        </div>
                    </div>`;
                }).join('');

            document.getElementById('law-list').innerHTML = lawListHtml || '<div class="loading">í‘œì‹œí•  ë²•ë ¹ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            document.getElementById('recent-count').textContent = `(${sortedItems.length}ê±´)`;

            console.log('ë°ì´í„° í‘œì‹œ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë”© ì‹œì‘
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>