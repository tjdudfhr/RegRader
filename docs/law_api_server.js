const express = require('express');
const cors = require('cors');
const axios = require('axios');
const app = express();

app.use(cors());
app.use(express.json());

// 국가법령정보센터 API 키
const API_KEY = 'W2409021544474496898474';

// 2025년 시행 법규 조회
app.get('/api/laws/2025', async (req, res) => {
    const { startDate = '20250101', endDate = '20251231', page = 1 } = req.query;
    
    // 현재는 실제 API 호출이 어려우므로 바로 샘플 데이터 반환
    console.log(`법규 조회 요청: ${startDate} ~ ${endDate}, page: ${page}`);
    
    const sampleData = getSample2025Laws(startDate, endDate);
    res.json({
        success: true,
        data: sampleData,
        totalCount: sampleData.length,
        page: page,
        note: '2025년 시행 예정 법규 샘플 데이터'
    });
    
    // 실제 API 호출 시도 (백그라운드)
    /*
    try {
        const url = 'https://www.law.go.kr/DRF/lawSearch.do';
        const params = {
            OC: API_KEY,
            target: 'eflaw',
            type: 'json',
            display: 100,
            page: page,
            efYd: startDate,
            efYdEnd: endDate
        };
        
        const response = await axios.get(url, { params, timeout: 5000 });
        
        if (response.data && response.data.law) {
            console.log('실제 API 데이터 수신 성공');
        }
    } catch (error) {
        console.log('API 호출 실패 (예상됨):', error.message);
    }
    */
});

// 샘플 데이터
function getSample2025Laws(startDate, endDate) {
    const laws = [
        // 2025년 1월 시행
        { 법령명한글: '개인정보 보호법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '개인정보보호위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '개인정보 보호법 시행령', 시행일자: '20250201', 법령구분명: '대통령령', 소관부처명: '개인정보보호위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '개인정보 보호법 시행규칙', 시행일자: '20250301', 법령구분명: '부령', 소관부처명: '개인정보보호위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '근로기준법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '최저임금법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '산업안전보건법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '중대재해 처벌 등에 관한 법률', 시행일자: '20250127', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '소득세법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '법인세법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '부가가치세법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '조세특례제한법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '국세기본법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '자본시장과 금융투자업에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '은행법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '보험업법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '신용정보의 이용 및 보호에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '전자금융거래법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '정보통신망 이용촉진 및 정보보호 등에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '과학기술정보통신부', 제개정구분명: '일부개정' },
        { 법령명한글: '전자상거래 등에서의 소비자보호에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '공정거래위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '독점규제 및 공정거래에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '공정거래위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '하도급거래 공정화에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '공정거래위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '대규모유통업에서의 거래 공정화에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '공정거래위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '환경정책기본법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '대기환경보전법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '물환경보전법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '폐기물관리법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '화학물질관리법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '화학물질의 등록 및 평가 등에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '의료법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '약사법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '국민건강보험법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '감염병의 예방 및 관리에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '의료기기법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '식품의약품안전처', 제개정구분명: '일부개정' },
        { 법령명한글: '화장품법', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '식품의약품안전처', 제개정구분명: '일부개정' },
        { 법령명한글: '건강기능식품에 관한 법률', 시행일자: '20250101', 법령구분명: '법률', 소관부처명: '식품의약품안전처', 제개정구분명: '일부개정' },
        
        // 2025년 3월 시행
        { 법령명한글: '개인정보 보호법', 시행일자: '20250314', 법령구분명: '법률', 소관부처명: '개인정보보호위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '금융소비자 보호에 관한 법률', 시행일자: '20250325', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        
        // 2025년 4월 시행
        { 법령명한글: '자본시장과 금융투자업에 관한 법률', 시행일자: '20250401', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '산업재해보상보험법', 시행일자: '20250401', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        
        // 2025년 7월 시행
        { 법령명한글: '소득세법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '법인세법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '부가가치세법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '조세특례제한법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '기획재정부', 제개정구분명: '일부개정' },
        { 법령명한글: '근로기준법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '고용보험법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '산업안전보건법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '고용노동부', 제개정구분명: '일부개정' },
        { 법령명한글: '정보통신망 이용촉진 및 정보보호 등에 관한 법률', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '과학기술정보통신부', 제개정구분명: '일부개정' },
        { 법령명한글: '가상자산 이용자 보호 등에 관한 법률', 시행일자: '20250719', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '제정' },
        { 법령명한글: '자본시장과 금융투자업에 관한 법률', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '보험업법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '신용정보의 이용 및 보호에 관한 법률', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '금융위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '독점규제 및 공정거래에 관한 법률', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '공정거래위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '대기환경보전법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '폐기물관리법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '환경부', 제개정구분명: '일부개정' },
        { 법령명한글: '의료법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '약사법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        { 법령명한글: '국민건강보험법', 시행일자: '20250701', 법령구분명: '법률', 소관부처명: '보건복지부', 제개정구분명: '일부개정' },
        
        // 2025년 9월 시행
        { 법령명한글: '개인정보 보호법', 시행일자: '20250914', 법령구분명: '법률', 소관부처명: '개인정보보호위원회', 제개정구분명: '일부개정' },
        { 법령명한글: '산업안전보건법 시행규칙', 시행일자: '20250901', 법령구분명: '부령', 소관부처명: '고용노동부', 제개정구분명: '일부개정' }
    ];
    
    // 날짜 필터링
    const start = parseInt(startDate);
    const end = parseInt(endDate);
    
    return laws.filter(law => {
        const lawDate = parseInt(law.시행일자);
        return lawDate >= start && lawDate <= end;
    });
}

// 서버 시작
const PORT = 3002;
app.listen(PORT, () => {
    console.log(`Law API Server running on port ${PORT}`);
    console.log(`API endpoint: http://localhost:${PORT}/api/laws/2025`);
});